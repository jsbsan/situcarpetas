' Gambas class file

Public Sub Form_Open()

  FileChooser1.FileView.ShowDetailed = True
  FileChooser2.FileView.ShowDetailed = True
  FileChooser3.FileView.ShowDetailed = True
  FileChooser4.FileView.ShowDetailed = True

  FileChooser1.dir = settings["dir1", User.home]
  FileChooser2.dir = settings["dir2", User.home]
  FileChooser3.dir = settings["dir3", User.home]
  FileChooser4.dir = settings["dir4", User.home]

  TextArea1.Text = Settings["texto", ""]
  textboxNombre.text = Settings["sesion", ""]
  Settings.Read(Me)
  ButtonOcultarPegar.tag = "1"
  ButtonOcultarPegar_Click()

End

Public Sub grupo_activate() 'hacer doble clik o boton OK

  Try Desktop.Open(Last.value)

End

Public Sub ButtonGuardar_Click()

  Dim datos As String

  If Not Exist(User.home & "/" & "VistaCarpetas") Then
    Mkdir User.home & "/" & "VistaCarpetas/"
  Endif

  Dialog.Path = User.home & "/" & "VistaCarpetas/"

  Dialog.Filter = ["*.vistacarpetas", "Fichero VistaCarpetas"]

  If Not Dialog.SaveFile() Then
    datos = FileChooser1.Dir & gb.CrLf
    datos &= FileChooser2.Dir & gb.CrLf
    datos &= FileChooser3.Dir & gb.CrLf
    datos &= FileChooser4.Dir & gb.CrLf
    datos &= Replace(TextArea1.text, "\n", "|")

    If File.Ext(Dialog.path) <> "vistacarpetas" Then
      File.Save(Dialog.Path & ".vistacarpetas", datos)
    Else
      File.Save(Dialog.Path, datos)

    Endif

  Endif

End

Public Sub ButtonAbrir_Click()

  Dim datos As String[]

  If Not Exist(User.home & "/" & "VistaCarpetas") Then
    Mkdir User.home & "/" & "VistaCarpetas"
  Endif

  Dialog.Filter = ["*.vistacarpetas", "Fichero VistaCarpetas"]

  Dialog.path = User.home & "/" & "VistaCarpetas"

  If Not Dialog.OpenFile() Then
    datos = Split(File.Load(Dialog.Path), gb.CrLf)
    textboxNombre.Text = File.BaseName(Dialog.Path)

    FileChooser1.dir = datos[0]
    FileChooser2.dir = datos[2]
    FileChooser3.dir = datos[4]
    FileChooser4.dir = datos[6]
    Try TextArea1.text = Replace(datos[8], "|", "\n")
  Endif

End

Public Sub Form_Close()

  settings["dir1"] = FileChooser1.dir
  settings["dir2"] = FileChooser2.dir
  settings["dir3"] = FileChooser3.dir
  settings["dir4"] = FileChooser4.dir
  Settings["texto"] = TextArea1.Text
  Settings["sesion"] = textboxNombre.Text
  Settings.write(Me)

End

Public Sub Button1fileviewCopiaryAbrir_Click()

  Clipboard.Copy(FileChooser2.dir)
  AbrirExplorador(FileChooser2.dir)

End

Public Sub Button2fileviewCopiaryAbrir_Click()

  Clipboard.Copy(FileChooser1.dir)
  AbrirExplorador(FileChooser1.dir)

End

Public Sub Button3fileviewCopiaryAbrir_Click()

  Clipboard.Copy(FileChooser3.dir)
  AbrirExplorador(FileChooser3.dir)

End

Public Sub Button4fileviewCopiaryAbrir_Click()

  Clipboard.Copy(FileChooser4.dir)
  AbrirExplorador(FileChooser4.dir)

End

Public Sub AbrirExplorador(ruta As String)

  Exec ["caja", ruta & "/"]

End

Public Sub Button1fileviewPegar_Click()

  Try FileChooser2.dir = Clipboard.Paste()

End

Public Sub Button2fileviewPegar_Click()

  Try FileChooser1.dir = Clipboard.Paste()

End

Public Sub Button3fileviewPegar_Click()

  Try FileChooser3.dir = Clipboard.Paste()

End

Public Sub Button4fileviewPegar_Click()

  Try FileChooser4.dir = Clipboard.Paste()

End

Public Sub ButtonOcultarPegar_Click()

  If ButtonOcultarPegar.tag = "" Then
    HBoxBotonesPegar.visible = True
    ButtonOcultarPegar.tag = "1"
  Else
    HBoxBotonesPegar.visible = False
    ButtonOcultarPegar.tag = ""
  Endif

End
